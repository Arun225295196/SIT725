<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIT725 MVC + Socket.IO Project</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
        }

        .container {
            margin-top: 2rem;
        }

        .card {
            height: 100%;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card-image {
            position: relative;
            overflow: hidden;
        }

        .card-image img {
            height: 200px;
            object-fit: cover;
            width: 100%;
            transition: transform 0.3s;
        }

        .card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-title {
            background: linear-gradient(45deg, rgba(33, 150, 243, 0.9), rgba(33, 150, 243, 0.7));
            padding: 12px !important;
            font-size: 1.1rem !important;
            font-weight: 500 !important;
            border-radius: 4px;
            margin: 8px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .card-content {
            padding: 20px !important;
        }

        .card-content p {
            margin-bottom: 15px;
            line-height: 1.5;
            color: #666;
        }

        .chip {
            margin-top: 10px;
            margin-bottom: 10px;
            background-color: #e3f2fd;
            color: #1976d2;
            font-weight: 500;
        }

        .card-action {
            padding: 16px 20px !important;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-action a {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .card-action a:hover {
            background-color: rgba(33, 150, 243, 0.1);
            transform: translateY(-1px);
        }

        .card-action a.red-text:hover {
            background-color: rgba(244, 67, 54, 0.1);
        }

        .modal {
            max-height: 90%;
            border-radius: 8px;
        }

        .modal-content h4 {
            color: #1976d2;
            margin-bottom: 25px;
        }

        /* Navigation fixes */
        .nav-wrapper ul li a {
            display: flex !important;
            align-items: center !important;
            padding: 0 15px !important;
            white-space: nowrap !important;
        }

        .nav-wrapper ul li a i.material-icons {
            margin-right: 5px !important;
            font-size: 16px !important;
            line-height: 1 !important;
        }

        .nav-wrapper ul li {
            float: left !important;
        }

        .brand-logo {
            font-size: 1.6rem !important;
            max-width: 60% !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }

        /* Fix for overlapping navigation items */
        nav ul a {
            font-size: 0.9rem !important;
        }

        @media only screen and (max-width: 992px) {
            .brand-logo {
                font-size: 1.3rem !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                max-width: 50% !important;
            }
            
            .nav-wrapper ul li a {
                padding: 0 10px !important;
                font-size: 0.8rem !important;
            }
        }

        @media only screen and (max-width: 768px) {
            .hide-on-med-and-down {
                display: none !important;
            }
        }

        .fixed-action-btn {
            position: fixed;
            right: 23px;
            bottom: 23px;
            z-index: 997;
        }

        /* Real-time notifications */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            z-index: 1000;
            display: none;
            border: 1px solid #e0e0e0;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .notification-item:hover {
            background-color: #f8f9fa;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item.new {
            background-color: #e8f5e8;
            animation: fadeIn 0.5s ease-in;
            border-left: 4px solid #4caf50;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Status indicators - removed status bar styles */

        .pulse-dot {
            width: 10px;
            height: 10px;
            background: #4caf50;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Chat styles */
        .chat-container {
            max-height: 350px;
            overflow-y: auto;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .chat-message {
            margin-bottom: 12px;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chat-message.own {
            background: #e3f2fd;
            margin-left: 30px;
            border-left: 3px solid #2196f3;
        }

        .typing-indicator {
            font-style: italic;
            color: #666;
            padding: 8px 15px;
            background-color: #f0f0f0;
            border-radius: 15px;
            display: inline-block;
        }

        .project-update {
            border-left: 4px solid #2196f3;
            padding: 12px 15px;
            margin: 15px 0;
            background: linear-gradient(90deg, #e3f2fd, #f5f5f5);
            border-radius: 0 8px 8px 0;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .created-date {
            font-size: 0.8rem;
            color: #999;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 10px;
        }

        .page-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .page-title h2 {
            color: #1976d2;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .page-title p {
            color: #666;
            font-size: 1.1rem;
        }

        

        .empty-state h5 {
            color: #666;
            margin-bottom: 15px;
        }

        .empty-state p {
            color: #999;
            margin-bottom: 25px;
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="blue darken-2">
        <div class="nav-wrapper container">
            <a href="#" class="brand-logo">SIT725 MVC + Socket.IO</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="#projects" class="waves-effect">Projects</a></li>
                <li><a href="#" onclick="openAddModal()" class="waves-effect">
                    <i class="material-icons">add</i>Add
                </a></li>
                <li><a href="#" onclick="openChatModal()" class="waves-effect">
                    <i class="material-icons">chat</i>Chat
                </a></li>
            </ul>
            <!-- Mobile menu trigger -->
            <a href="#" data-target="mobile-demo" class="sidenav-trigger show-on-med-and-down">
                <i class="material-icons">menu</i>
            </a>
        </div>
    </nav>

    <!-- Mobile Side Navigation -->
    <ul class="sidenav" id="mobile-demo">
        <li><a href="#projects" class="waves-effect">
            <i class="material-icons left">folder</i>Projects
        </a></li>
        <li><a href="#" onclick="openAddModal()" class="waves-effect">
            <i class="material-icons left">add</i>Add Project
        </a></li>
        <li><a href="#" onclick="openChatModal()" class="waves-effect">
            <i class="material-icons left">chat</i>Chat
        </a></li>
        <li><a href="#" onclick="toggleNotifications()" class="waves-effect">
            <i class="material-icons left">notifications</i>Notifications
        </a></li>
    </ul>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div style="padding: 15px; background: linear-gradient(135deg, #2196f3, #1976d2); color: white; font-weight: 500;">
            <i class="material-icons left">notifications_active</i>
            Real-time Updates
            <a href="#" onclick="clearNotifications()" class="white-text right" style="font-weight: normal;">
                <i class="material-icons tiny">clear</i>
            </a>
        </div>
        <div id="notificationList">
            <div class="notification-item center-align grey-text">
                <i class="material-icons">info_outline</i><br>
                No updates yet
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container" style="margin-top: 80px;">
        <div class="page-title">
            <h2>My Projects</h2>
            <p>Real-time MVC Architecture with Socket.IO</p>
            <div id="realtime-updates">
                <!-- Real-time updates will appear here -->
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="loading-container">
            <div class="preloader-wrapper active">
                <div class="spinner-layer spinner-blue-only">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Grid -->
        <div id="projects-container" class="row" style="display: none;">
            <!-- Projects will be loaded here -->
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fixed-action-btn">
        <a class="btn-floating btn-large blue darken-2 waves-effect waves-light" onclick="openAddModal()">
            <i class="large material-icons">add</i>
        </a>
        <ul>
            <li><a class="btn-floating green waves-effect waves-light" onclick="openChatModal()" title="Chat">
                <i class="material-icons">chat</i>
            </a></li>
            <li><a class="btn-floating orange waves-effect waves-light" onclick="showConnectionStatus()" title="Connection Status">
                <i class="material-icons">wifi</i>
            </a></li>
        </ul>
    </div>

    <!-- Add Project Modal -->
    <div id="addProjectModal" class="modal">
        <div class="modal-content">
            <h4><i class="material-icons left">add_circle</i>Add New Project</h4>
            <form id="addProjectForm" onsubmit="event.preventDefault(); addProject();">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="title" name="title" type="text" required class="validate">
                        <label for="title">Project Title *</label>
                        <span class="helper-text" data-error="Please enter a project title"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <textarea id="description" name="description" class="materialize-textarea validate" required></textarea>
                        <label for="description">Description *</label>
                        <span class="helper-text" data-error="Please enter a project description"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="category" name="category" class="validate">
                            <option value="" disabled selected>Choose category</option>
                            <option value="Web Development">Web Development</option>
                            <option value="Mobile App">Mobile App</option>
                            <option value="Data Science">Data Science</option>
                            <option value="Machine Learning">Machine Learning</option>
                            <option value="Socket Programming">Socket Programming</option>
                            <option value="Other">Other</option>
                        </select>
                        <label>Category</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="image" name="image" type="url" class="validate">
                        <label for="image">Image URL</label>
                        <span class="helper-text">Optional: Add an image URL for your project</span>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="link" name="link" type="url" class="validate">
                        <label for="link">Project Link</label>
                        <span class="helper-text">Optional: Add a link to your project</span>
                    </div>
                </div>
                <p><small><em>* Required fields</em></small></p>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-red btn-flat">
                <i class="material-icons left">cancel</i>Cancel
            </a>
            <button type="button" onclick="addProject()" class="waves-effect waves-green btn blue darken-2">
                <i class="material-icons left">add_circle</i>Add Project
            </button>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal modal-fixed-footer">
        <div class="modal-content">
            <h4><i class="material-icons left">chat</i>Real-time Chat</h4>
            <div class="chat-container" id="chatContainer">
                <div class="center-align grey-text">
                    <i class="material-icons">forum</i><br>
                    Start a conversation...
                </div>
            </div>
            <div id="typingIndicator" class="typing-indicator" style="display: none;"></div>
        </div>
        <div class="modal-footer" style="padding: 20px;">
            <div class="row" style="margin-bottom: 0;">
                <div class="input-field col s9">
                    <input id="chatMessage" type="text" placeholder="Type your message..." maxlength="500">
                    <label for="chatMessage">Message</label>
                </div>
                <div class="col s3">
                    <button onclick="sendChatMessage()" class="btn blue darken-2 full-width waves-effect waves-light">
                        <i class="material-icons">send</i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Socket.IO connection
        const socket = io();
        
        // Global variables
        let notifications = [];
        let username = 'User_' + Math.random().toString(36).substr(2, 9);
        let typingTimer;
        const TYPING_TIMER_LENGTH = 3000;

        // Initialize Materialize components
        document.addEventListener('DOMContentLoaded', function() {
            M.AutoInit();
            
            // Initialize mobile sidenav
            const sidenavElems = document.querySelectorAll('.sidenav');
            M.Sidenav.init(sidenavElems);
            
            loadProjects();
            
            // Setup chat input
            const chatInput = document.getElementById('chatMessage');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    } else {
                        socket.emit('typing', { username: username, isTyping: true });
                        clearTimeout(typingTimer);
                        typingTimer = setTimeout(() => {
                            socket.emit('typing', { username: username, isTyping: false });
                        }, TYPING_TIMER_LENGTH);
                    }
                });
            }
        });

        // Socket event listeners
        socket.on('connect', () => {
            console.log('Connected to server');
            document.getElementById('connection-status').textContent = 'Connected';
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
            document.getElementById('connection-status').textContent = 'Disconnected';
        });

        socket.on('welcome', (data) => {
            console.log('Welcome message:', data);
            M.toast({html: 'ðŸŽ‰ Welcome to the real-time project manager!', classes: 'green rounded'});
        });

        socket.on('userCount', (count) => {
            document.getElementById('user-count').textContent = count;
        });

        socket.on('userJoined', (data) => {
            addNotification(`ðŸ‘‹ ${data.message}`, 'info');
            showTemporaryUpdate('New user joined!');
        });

        socket.on('userLeft', (data) => {
            addNotification(`ðŸ‘‹ ${data.message}`, 'info');
            showTemporaryUpdate('A user left');
        });

        socket.on('projectCreated', (data) => {
            addNotification(`ðŸš€ ${data.message}`, 'success');
            showTemporaryUpdate(`New project: ${data.project.title}`);
            setTimeout(loadProjects, 500);
        });

        socket.on('projectUpdated', (data) => {
            addNotification(`âœï¸ ${data.message}`, 'info');
            showTemporaryUpdate(`Updated: ${data.project.title}`);
            setTimeout(loadProjects, 500);
        });

        socket.on('projectDeleted', (data) => {
            addNotification(`ðŸ—‘ï¸ ${data.message}`, 'warning');
            showTemporaryUpdate(`Deleted: ${data.projectTitle}`);
            setTimeout(loadProjects, 500);
        });

        socket.on('chatMessage', (data) => {
            displayChatMessage(data);
        });

        socket.on('userTyping', (data) => {
            if (data.isTyping) {
                showTypingIndicator(`${data.username} is typing...`);
            } else {
                hideTypingIndicator();
            }
        });

        // API base URL
        const API_BASE = '/api';

        // Load all projects
        async function loadProjects() {
            const loading = document.getElementById('loading');
            const container = document.getElementById('projects-container');
            
            loading.style.display = 'flex';
            container.style.display = 'none';
            
            try {
                console.log('Loading projects...');
                const response = await fetch(`${API_BASE}/projects`);
                const result = await response.json();
                
                console.log('Response:', result);
                
                if (result.success) {
                    displayProjects(result.data);
                } else {
                    M.toast({html: 'Error loading projects: ' + result.message, classes: 'red rounded'});
                }
            } catch (error) {
                console.error('Error loading projects:', error);
                M.toast({html: 'Network error loading projects', classes: 'red rounded'});
            } finally {
                loading.style.display = 'none';
                container.style.display = 'block';
            }
        }

        // Display projects in the grid
        function displayProjects(projects) {
            const container = document.getElementById('projects-container');
            container.innerHTML = '';
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="col s12">
                        <div class="card-panel empty-state">
                            <i class="material-icons large grey-text">folder_open</i>
                            <h5>No projects yet</h5>
                            <p>Create your first project to get started with real-time collaboration!</p>
                            <button onclick="openAddModal()" class="btn-large blue darken-2 waves-effect waves-light">
                                <i class="material-icons left">add_circle</i>Add Your First Project
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            projects.forEach(project => {
                const projectCard = createProjectCard(project);
                container.innerHTML += projectCard;
            });
        }

        // Create project card HTML
        function createProjectCard(project) {
            const createdDate = new Date(project.createdAt).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            return `
                <div class="col s12 m6 l4">
                    <div class="card hoverable">
                        <div class="card-image">
                            <img src="${project.image || 'https://via.placeholder.com/400x200/2196f3/ffffff?text=Project'}" 
                                 alt="${project.title}" 
                                 onerror="this.src='https://via.placeholder.com/400x200/2196f3/ffffff?text=Project'">
                            <span class="card-title">${project.title}</span>
                        </div>
                        <div class="card-content">
                            <p>${project.description}</p>
                            <div class="chip">
                                <i class="material-icons tiny left">label</i>
                                ${project.category || 'Uncategorized'}
                            </div>
                            <div class="created-date">
                                <i class="material-icons tiny">access_time</i>
                                Created: ${createdDate}
                            </div>
                        </div>
                        <div class="card-action">
                            <a href="${project.link || '#'}" target="_blank" class="blue-text waves-effect">
                                <i class="material-icons tiny">launch</i>
                                VIEW PROJECT
                            </a>
                            <a href="#" onclick="deleteProject(${project.id})" class="red-text waves-effect">
                                <i class="material-icons tiny">delete</i>
                                DELETE
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Rest of the JavaScript functions remain the same...
        // (All the socket functions, modal functions, etc. from the previous version)

        // Open add project modal
        function openAddModal() {
            console.log('Opening modal...');
            const modalElem = document.getElementById('addProjectModal');
            const modal = M.Modal.getInstance(modalElem);
            
            if (modal) {
                modal.open();
            } else {
                console.error('Modal not initialized');
                M.toast({html: 'Error opening modal', classes: 'red rounded'});
            }
        }

        // Open chat modal
        function openChatModal() {
            const modalElem = document.getElementById('chatModal');
            const modal = M.Modal.getInstance(modalElem);
            if (modal) {
                modal.open();
            }
        }

        // Add new project
        async function addProject() {
            console.log('Add project function called');
            
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const category = document.getElementById('category').value;
            const image = document.getElementById('image').value.trim();
            const link = document.getElementById('link').value.trim();
            
            if (!title || !description) {
                M.toast({html: 'Title and description are required', classes: 'red rounded'});
                return;
            }
            
            const formData = {
                title: title,
                description: description,
                category: category || 'Uncategorized',
                image: image || 'https://via.placeholder.com/400x200/2196f3/ffffff?text=Project',
                link: link || '#'
            };
            
            try {
                const response = await fetch(`${API_BASE}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    M.toast({html: 'âœ… Project added successfully!', classes: 'green rounded'});
                    
                    socket.emit('projectCreated', result.data);
                    
                    const modal = M.Modal.getInstance(document.getElementById('addProjectModal'));
                    modal.close();
                    
                    document.getElementById('addProjectForm').reset();
                    const selectElem = document.getElementById('category');
                    M.FormSelect.init(selectElem);
                    M.updateTextFields();
                    
                    loadProjects();
                } else {
                    M.toast({html: result.message || 'Error adding project', classes: 'red rounded'});
                }
            } catch (error) {
                console.error('Error adding project:', error);
                M.toast({html: 'Network error adding project', classes: 'red rounded'});
            }
        }

        // Delete project
        async function deleteProject(id) {
            if (!confirm('Are you sure you want to delete this project?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/projects/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    M.toast({html: 'âœ… Project deleted successfully!', classes: 'green rounded'});
                    socket.emit('projectDeleted', { projectId: id });
                    loadProjects();
                } else {
                    M.toast({html: result.message || 'Error deleting project', classes: 'red rounded'});
                }
            } catch (error) {
                console.error('Error deleting project:', error);
                M.toast({html: 'Network error deleting project', classes: 'red rounded'});
            }
        }

        // Notification functions
        function addNotification(message, type) {
            const notification = {
                id: Date.now(),
                message: message,
                type: type,
                timestamp: new Date(),
                read: false
            };
            
            notifications.unshift(notification);
            updateNotificationDisplay();
            updateNotificationCount();
        }

        function updateNotificationDisplay() {
            const notificationList = document.getElementById('notificationList');
            if (notifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="notification-item center-align grey-text">
                        <i class="material-icons">info_outline</i><br>
                        No updates yet
                    </div>
                `;
                return;
            }
            
            notificationList.innerHTML = notifications.slice(0, 10).map(notification => `
                <div class="notification-item ${notification.read ? '' : 'new'}">
                    <div style="font-weight: ${notification.read ? 'normal' : 'bold'};">
                        ${notification.message}
                    </div>
                    <div class="grey-text" style="font-size: 0.8rem; margin-top: 5px;">
                        ${notification.timestamp.toLocaleTimeString()}
                    </div>
                </div>
            `).join('');
        }

        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length;
            document.getElementById('notification-count').textContent = unreadCount;
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            const isVisible = panel.style.display !== 'none';
            
            if (isVisible) {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
                notifications.forEach(n => n.read = true);
                updateNotificationDisplay();
                updateNotificationCount();
            }
        }

        function clearNotifications() {
            notifications = [];
            updateNotificationDisplay();
            updateNotificationCount();
            M.toast({html: 'Notifications cleared', classes: 'blue rounded'});
        }

        // Chat functions
        function sendChatMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (message) {
                socket.emit('chatMessage', {
                    message: message,
                    username: username
                });
                messageInput.value = '';
                M.updateTextFields();
                
                socket.emit('typing', { username: username, isTyping: false });
            }
        }

        function displayChatMessage(data) {
            const chatContainer = document.getElementById('chatContainer');
            const isOwnMessage = data.socketId === socket.id;
            
            // Remove the "Start a conversation" message if it exists
            const startMsg = chatContainer.querySelector('.center-align');
            if (startMsg) startMsg.remove();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isOwnMessage ? 'own' : ''}`;
            messageDiv.innerHTML = `
                <div style="font-weight: bold; color: ${isOwnMessage ? '#1976d2' : '#666'}; margin-bottom: 5px;">
                    <i class="material-icons tiny left">${isOwnMessage ? 'person' : 'person_outline'}</i>
                    ${isOwnMessage ? 'You' : data.username}
                </div>
                <div style="margin-bottom: 5px;">${data.message}</div>
                <div class="grey-text" style="font-size: 0.8rem;">
                    ${new Date(data.timestamp).toLocaleTimeString()}
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator(text) {
            const indicator = document.getElementById('typingIndicator');
            indicator.innerHTML = `<i class="material-icons tiny left">edit</i>${text}`;
            indicator.style.display = 'block';
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function showTemporaryUpdate(message) {
            const updatesDiv = document.getElementById('realtime-updates');
            updatesDiv.innerHTML = `
                <div class="project-update">
                    <i class="material-icons tiny left">update</i>
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                updatesDiv.innerHTML = '';
            }, 4000);
        }

        // Click outside to close notifications
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('notificationPanel');
            const isClickInsidePanel = panel.contains(event.target);
            const isClickOnToggle = event.target.closest('[onclick="toggleNotifications()"]');
            
            if (!isClickInsidePanel && !isClickOnToggle && panel.style.display !== 'none') {
                panel.style.display = 'none';
            }
        });

        // Add some nice interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Add ripple effect to cards
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('click', function(e) {
                    // Only add ripple if not clicking on action buttons
                    if (!e.target.closest('.card-action')) {
                        const ripple = document.createElement('div');
                        ripple.className = 'ripple';
                        ripple.style.left = e.offsetX + 'px';
                        ripple.style.top = e.offsetY + 'px';
                        this.appendChild(ripple);
                        
                        setTimeout(() => {
                            ripple.remove();
                        }, 600);
                    }
                });
            });
        });

        // Smooth scroll for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Auto-refresh projects every 30 seconds as backup
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                console.log('Auto-refreshing projects...');
                loadProjects();
            }
        }, 30000);

        // Show connection status changes with better feedback
        socket.on('connect', () => {
            document.getElementById('connection-status').innerHTML = `
                <i class="material-icons tiny left">wifi</i>Connected
            `;
            M.toast({html: 'ðŸ”Œ Connected to server', classes: 'green rounded'});
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').innerHTML = `
                <i class="material-icons tiny left">wifi_off</i>Disconnected
            `;
            M.toast({html: 'ðŸ“± Connection lost - trying to reconnect...', classes: 'orange rounded'});
        });

        socket.on('reconnect', () => {
            M.toast({html: 'âœ… Reconnected successfully!', classes: 'green rounded'});
            loadProjects(); // Refresh data after reconnection
        });
    </script>
</body>
</html>